# ğŸ”§ GLAD Labs .env File Setup Guide

**Status:** Production-Ready Configuration  
**Last Updated:** October 23, 2025  
**Purpose:** Clear instructions for setting up environment variables across all environments

---

## âœ… Quick Summary

You have **3 environments** that need **3 different `.env` files**:

| Environment    | File              | Location | Secrets? | Git      | When Used                           |
| -------------- | ----------------- | -------- | -------- | -------- | ----------------------------------- |
| **Local Dev**  | `.env`            | Root     | âœ… YES   | âŒ NEVER | `npm run dev` locally               |
| **Staging**    | `.env.staging`    | Root     | âŒ NO    | âœ… YES   | `dev` branch â†’ Railway staging      |
| **Production** | `.env.production` | Root     | âŒ NO    | âœ… YES   | `main` branch â†’ Railway/Vercel prod |

---

## ğŸ“‹ What Goes Where

### ğŸ” NEVER in Git (Local Only - Add to .gitignore)

These files contain **REAL secrets** and should ONLY exist on your machine:

```
.env                  # Local dev - YOUR secrets
.env.local            # Next.js local override - YOUR secrets
.env.secrets          # Additional local secrets file
```

**Your `.gitignore` should have:**

```gitignore
# Environment files (local - NEVER commit)
.env
.env.local
.env.secrets
.env.*.local

# But DO allow these (they have NO secrets):
!.env.example
!.env.staging
!.env.production
```

---

### âœ… Always in Git (No Secrets - Templates Only)

These files are **SAFE to commit** because they have NO API keys:

```
.env.example         # Template - shows what's needed, no secrets
.env.staging         # Staging config - references GitHub Secrets
.env.production      # Production config - references GitHub Secrets
```

---

## ğŸ¯ The Three Files Explained

### 1ï¸âƒ£ `.env` (Local Development - Your Machine)

**Where:** Root directory (C:\Users\mattm\glad-labs-website\)  
**Commit:** âŒ NEVER - It's in `.gitignore`  
**Secrets:** âœ… YES - Your real API keys go here  
**Who sees it:** Only you  
**When used:** `npm run dev` on your local machine

**What goes in it:**

```bash
# === For Local Development ===
NODE_ENV=development
LOG_LEVEL=DEBUG

# === Local API Endpoints ===
NEXT_PUBLIC_STRAPI_API_URL=http://localhost:1337
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000

# === YOUR REAL API KEYS (KEEP SECRET!) ===
OPENAI_API_KEY=sk-xxxxxxx                          # Your OpenAI key
ANTHROPIC_API_KEY=sk-ant-xxxxxxx                   # Your Anthropic key
GOOGLE_API_KEY=AIzaxxxxxxx                         # Your Google key

# === Database (SQLite for local) ===
DATABASE_CLIENT=sqlite
DATABASE_FILENAME=.tmp/data.db

# === Strapi Secrets (Generated locally, no one else needs them) ===
STRAPI_JWT_SECRET=random-secret-here
STRAPI_ADMIN_JWT_SECRET=random-secret-here
STRAPI_APP_KEYS=key1,key2,key3,key4
STRAPI_API_TOKEN_SALT=random-salt-here

# === Strapi API Token (for Next.js to connect) ===
STRAPI_API_TOKEN=your-local-strapi-token-here
```

**ğŸ“Œ How to create:**

```bash
# Copy from example
cp .env.example .env

# Then edit .env with your secrets
# nano .env  (or use VS Code)

# Add your real API keys:
# - OpenAI API key
# - Anthropic API key (optional)
# - Google API key (optional)
```

---

### 2ï¸âƒ£ `.env.staging` (Staging Environment - Railway Staging)

**Where:** Root directory (committed to Git)  
**Commit:** âœ… YES - Safe, no secrets  
**Secrets:** âŒ NO - Placeholders only  
**Who sees it:** Everyone (it's in Git)  
**When used:** GitHub Actions deploys `dev` branch â†’ Railway staging

**What goes in it:**

```bash
# === For Staging Environment ===
NODE_ENV=staging
LOG_LEVEL=DEBUG

# === Staging API Endpoints ===
NEXT_PUBLIC_STRAPI_API_URL=https://cms-staging.railway.app
NEXT_PUBLIC_API_BASE_URL=https://api-staging.railway.app
NEXT_PUBLIC_COFOUNDER_AGENT_URL=https://agent-staging.railway.app:8000

# === Database (PostgreSQL on Railway) ===
DATABASE_CLIENT=postgres
DATABASE_HOST=staging-db.railway.app
DATABASE_PORT=5432
DATABASE_NAME=glad_labs_staging
# DATABASE_USER and DATABASE_PASSWORD come from GitHub Secrets

# === Strapi API Token ===
STRAPI_API_TOKEN=placeholder-will-be-replaced-by-github-secrets

# === Ports ===
STRAPI_PORT=1337
PUBLIC_SITE_PORT=3000
OVERSIGHT_HUB_PORT=3001
COFOUNDER_AGENT_PORT=8000

# === Feature Flags ===
ENABLE_ANALYTICS=true
ENABLE_ERROR_REPORTING=true
ENABLE_DEBUG_LOGS=false
ENABLE_PAYMENT_PROCESSING=false    # Test mode only

# === Timeouts ===
API_TIMEOUT=15000
API_RETRY_ATTEMPTS=2
RATE_LIMIT_REQUESTS_PER_MINUTE=100
```

**ğŸ“Œ How to create:**

```bash
# Create from template
cat > .env.staging << 'EOF'
# Copy content from above
EOF

# Then commit to Git
git add .env.staging
git commit -m "chore: add staging environment variables"
```

---

### 3ï¸âƒ£ `.env.production` (Production - Vercel + Railway)

**Where:** Root directory (committed to Git)  
**Commit:** âœ… YES - Safe, no secrets  
**Secrets:** âŒ NO - Placeholders only  
**Who sees it:** Everyone (it's in Git)  
**When used:** GitHub Actions deploys `main` branch â†’ Vercel/Railway production

**What goes in it:**

```bash
# === For Production Environment ===
NODE_ENV=production
LOG_LEVEL=INFO

# === Production API Endpoints ===
NEXT_PUBLIC_STRAPI_API_URL=https://cms.glad-labs.com          # Your domain
NEXT_PUBLIC_API_BASE_URL=https://api.glad-labs.com            # Your domain
NEXT_PUBLIC_COFOUNDER_AGENT_URL=https://agent.glad-labs.com:8000

# === Database (PostgreSQL on Railway) ===
DATABASE_CLIENT=postgres
DATABASE_HOST=prod-db.railway.app
DATABASE_PORT=5432
DATABASE_NAME=glad_labs_production
# DATABASE_USER and DATABASE_PASSWORD come from GitHub Secrets

# === Strapi API Token ===
STRAPI_API_TOKEN=placeholder-will-be-replaced-by-github-secrets

# === Ports ===
STRAPI_PORT=1337
PUBLIC_SITE_PORT=3000
OVERSIGHT_HUB_PORT=3001
COFOUNDER_AGENT_PORT=8000

# === Feature Flags ===
ENABLE_ANALYTICS=true
ENABLE_ERROR_REPORTING=true
ENABLE_DEBUG_LOGS=false
ENABLE_PAYMENT_PROCESSING=true     # Live payments enabled

# === Timeouts ===
API_TIMEOUT=10000
API_RETRY_ATTEMPTS=3
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
```

---

## ğŸ” GitHub Secrets (The Real Secrets Storage)

**GitHub Secrets** hold your actual API keys - NOT in any `.env` file!

### Set these in GitHub (Settings â†’ Secrets and variables â†’ Actions):

**For Staging Environment:**

```
STAGING_STRAPI_API_URL      = https://cms-staging.railway.app
STAGING_STRAPI_API_TOKEN    = your-actual-staging-strapi-token
STAGING_OPENAI_API_KEY      = sk-xxxxxxx
STAGING_ANTHROPIC_API_KEY   = sk-ant-xxxxxxx
STAGING_GOOGLE_API_KEY      = AIzaxxxxxxx
STAGING_DATABASE_PASSWORD   = your-staging-db-password
```

**For Production Environment:**

```
PROD_STRAPI_API_URL         = https://cms.glad-labs.com
PROD_STRAPI_API_TOKEN       = your-actual-prod-strapi-token
PROD_OPENAI_API_KEY         = sk-xxxxxxx
PROD_ANTHROPIC_API_KEY      = sk-ant-xxxxxxx
PROD_GOOGLE_API_KEY         = AIzaxxxxxxx
PROD_DATABASE_PASSWORD      = your-prod-db-password
```

**For Both Staging & Production:**

```
RAILWAY_TOKEN               = your-railway-cli-token
VERCEL_TOKEN                = your-vercel-cli-token
VERCEL_PROJECT_ID           = your-vercel-project-id
```

---

## ğŸš€ Setup Checklist

### Step 1: Local Development Setup

- [ ] Copy `.env.example` â†’ `.env`
- [ ] Add your real API keys to `.env`:
  - [ ] `OPENAI_API_KEY` (or other AI provider)
  - [ ] `STRAPI_API_TOKEN` (from local Strapi admin)
  - [ ] Other secrets
- [ ] **NEVER commit `.env`** (already in `.gitignore`)
- [ ] Test: `npm run dev` should work

### Step 2: Staging Environment Setup

- [ ] Create `.env.staging` file (no secrets, placeholders only)
- [ ] Set all staging API endpoints (railway URLs)
- [ ] Commit to Git: `git add .env.staging`
- [ ] Set GitHub Secrets for staging (STAGING\_\* variables)
- [ ] Test: GitHub Actions deploys `dev` branch

### Step 3: Production Environment Setup

- [ ] Create `.env.production` file (no secrets, placeholders only)
- [ ] Set all production API endpoints (your actual domains)
- [ ] Commit to Git: `git add .env.production`
- [ ] Set GitHub Secrets for production (PROD\_\* variables)
- [ ] Test: GitHub Actions deploys `main` branch

### Step 4: Verify .gitignore

- [ ] Check `.gitignore` has:
  ```
  .env
  .env.local
  .env.secrets
  ```
- [ ] Check `.gitignore` has:
  ```
  !.env.example
  !.env.staging
  !.env.production
  ```

---

## ğŸ¯ Example: Adding Vercel Environment Variables

**WHAT YOU SHOULD HAVE IN VERCEL:**

```
NEXT_PUBLIC_STRAPI_API_URL    = https://cms.railway.app
STRAPI_API_TOKEN              = (from GitHub Secrets)
```

**WHAT YOU SHOULD NOT HAVE IN VERCEL:**

```
âŒ OPENAI_API_KEY             (Backend only - needs Railway)
âŒ ANTHROPIC_API_KEY          (Backend only - needs Railway)
âŒ GOOGLE_API_KEY             (Backend only - needs Railway)
âŒ DATABASE_*                 (Backend only - needs Railway)
âŒ GCP_PROJECT_ID             (Backend only - needs Railway)
```

**Why?** Frontend in Vercel only needs to know:

- Where the Strapi CMS is (public URL)
- How to talk to the backend (API token)

**Backend in Railway needs:**

- Database connection
- AI API keys
- Google Cloud credentials
- Everything else

---

## â“ Common Questions

### Q: Can I use the same `.env` file for all environments?

**A:** NO! Each environment (local, staging, prod) needs different API endpoints.

### Q: Where do I put my REAL API keys?

**A:**

- **Local:** In `.env` (never commit)
- **Staging/Prod:** In GitHub Secrets (GitHub manages them, GitHub Actions injects them)

### Q: What if I accidentally commit `.env`?

```bash
# Remove it from Git history
git rm --cached .env
git commit -m "chore: remove .env from tracking"
git push

# It will still be on your machine (safe)
```

### Q: How does GitHub Actions get my secrets?

**Flow:**

```
GitHub Secrets (centralized, encrypted)
    â†“
GitHub Actions workflow reads them
    â†“
Passes to Railway/Vercel at deploy time
    â†“
Never stored in files, never in Git
```

### Q: What about `.env.local`?

**A:** Next.js specific file for local overrides. Also never commit (in `.gitignore`).

---

## ğŸ“ Your Current Files Status

### What you HAVE:

```
âœ… .env                    (local, has secrets, not committed)
âœ… .env.example            (template, committed)
âœ… .env.staging            (staging config, committed)
âœ… .env.production         (production config, committed)
â“ .env.tier1.production   (unclear - may be old/unused)
â“ .env.old                (old backup - can delete)
```

### What you NEED:

```
âœ… .env                    (keep as-is, has YOUR secrets)
âœ… .env.staging            (verify content matches guide)
âœ… .env.production         (verify content matches guide)
```

### What you can DELETE:

```
ğŸ—‘ï¸  .env.tier1.production  (old tier naming, use .env.production instead)
ğŸ—‘ï¸  .env.old               (backup, no longer needed)
ğŸ—‘ï¸  .env.local             (Next.js override, not needed)
```

---

## ğŸ”„ Deployment Flow (With Correct .env Files)

```
1. Local Development
   â””â”€ You use: .env (with your real secrets)
   â””â”€ npm run dev

2. Push to dev branch
   â””â”€ GitHub Actions reads: .env.staging + GitHub Secrets
   â””â”€ Deploys to Railway staging

3. Push to main branch
   â””â”€ GitHub Actions reads: .env.production + GitHub Secrets
   â””â”€ Deploys to Vercel (frontend) + Railway (backend)
```

---

## âœ¨ Next Steps

1. **Review your current `.env` files:**

   ```bash
   ls -la .env*
   ```

2. **Verify `.env.staging` and `.env.production` are correct** (use templates above)

3. **Delete old files:**

   ```bash
   rm .env.tier1.production .env.old .env.local
   ```

4. **Set GitHub Secrets** (see section above)

5. **Test locally:**

   ```bash
   npm run dev  # Should work with your .env
   ```

6. **Commit changes:**
   ```bash
   git add .env.staging .env.production
   git commit -m "chore: clean up env files and verify structure"
   git push origin feat/test-branch
   ```

---

**Questions?** Check `docs/07-BRANCH_SPECIFIC_VARIABLES.md` for more details.
