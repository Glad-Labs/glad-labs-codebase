# üîí Security Vulnerability Remediation Guide

**Date**: October 21, 2025  
**Status**: 28 Vulnerabilities Found (1 Critical, 11 High, 2 Moderate, 14 Low)  
**Priority**: HIGH - Production system affected  
**Recommendation**: Immediate Strapi upgrade required

---

## ‚ö†Ô∏è Critical Issues Summary

### Current State

- **Strapi Version**: 5.18.1 (OLD - 10 minor versions behind)
- **Latest Available**: 5.28.0 (9+ patches ahead)
- **Unfixable Vulnerabilities**: 11 in Strapi (require upgrade)
- **Fixable Vulnerabilities**: 17 (can be patched with `npm audit fix`)

### Severity Breakdown

| Level        | Count | Examples                                              |
| ------------ | ----- | ----------------------------------------------------- |
| **CRITICAL** | 1     | Strapi - Multiple command injection vulnerabilities   |
| **HIGH**     | 11    | Axios DoS, Koa redirect, Tmp symlink, nth-check ReDoS |
| **MODERATE** | 2     | Vite, webpack-dev-server source code leaks            |
| **LOW**      | 14    | Various dependencies                                  |

---

## üö® Critical Vulnerabilities (Unfixable at Current Version)

### Strapi v5.18.1 Known Issues

**1. Command Injection (GHSA-9p2w-rmx4-9mw7)**

- Allows attackers to execute arbitrary OS commands
- Fixed in: Strapi 5.25.0+
- Impact: CRITICAL

**2. Unauthenticated Admin Password Reset (GHSA-6xc2-mj39-q599)**

- Admin password can be reset without valid token
- Fixed in: Strapi 5.26.0+
- Impact: CRITICAL

**3. Cross-Site Scripting (GHSA-mcqm-6ff4-53qx)**

- XSS vulnerability in admin panel
- Fixed in: Strapi 5.23.0+
- Impact: HIGH

**4. File Upload Vulnerabilities (GHSA-9qgm-w87q-hx89)**

- Unrestricted file upload with dangerous types
- Fixed in: Strapi 5.24.0+
- Impact: HIGH

**5. Authorization Bypass (GHSA-7frv-9phw-vrvr)**

- Role-based access control can be bypassed
- Fixed in: Strapi 5.27.0+
- Impact: HIGH

**6. Additional Issues**:

- Improper input validation (GHSA-65wv-528r-m892)
- Insecure password handling (GHSA-85vg-grr5-pw42)
- OS command injection (GHSA-49vv-6q7q-w5cf)
- Hidden attributes mishandling (GHSA-4phg-hpqm-c3j4)
- Weak password recovery (GHSA-37hx-4mcq-wc3h)

---

## ‚úÖ Recommended Fix Strategy

### Option 1: IMMEDIATE UPGRADE (Recommended)

**This fixes 27/28 vulnerabilities immediately**

```bash
# Upgrade Strapi to latest secure version
cd cms/strapi-main
npm install @strapi/strapi@5.28.0
npm install @strapi/plugin-users-permissions@5.28.0
npm install @strapi/provider-upload-local@5.28.0

# Run audit fix for remaining issues
npm audit fix

# Go back to root
cd ../..

# Verify build works
npm run build
```

**Expected Results**:

- ‚úÖ All 11 Strapi vulnerabilities eliminated
- ‚úÖ Axios DoS vulnerability fixed (updated version)
- ‚úÖ Koa redirect vulnerability fixed
- ‚úÖ Tmp symlink vulnerability fixed
- ‚úÖ nth-check ReDoS fixed
- ‚úÖ Vite & webpack-dev-server issues patched
- ‚úÖ Safe for production deployment

**Estimated Time**: 5-10 minutes  
**Risk Level**: LOW (Strapi 5.28.0 is stable, tested, production-ready)  
**Breaking Changes**: Minimal to none (patch-level upgrade within v5.x)

---

### Option 2: Temporary Partial Fix (NOT Recommended)

If you absolutely cannot upgrade Strapi now:

```bash
npm audit fix --force
```

**What This Does**:

- ‚úÖ Fixes 17/28 vulnerabilities
- ‚ùå Leaves 11 Strapi vulnerabilities unfixed
- ‚ö†Ô∏è Still at risk for critical exploits

**Not recommended because**:

- Strapi vulnerabilities are CRITICAL
- Production data still at risk
- Deployment delay won't help - must upgrade eventually

---

### Option 3: Security Hardening (Supplement)

While upgrading, implement these protections:

```bash
# 1. Run restricted audit
npm audit --audit-level=high

# 2. Generate security report
npm audit > security-report.txt

# 3. Document current state
npm ls --depth=0 > dependencies.txt
```

**Additional hardening**:

- Restrict Strapi to internal networks only
- Use environment-based configuration
- Enable CORS restrictions
- Set security headers
- Run with non-root user
- Monitor logs for suspicious activity

---

## üìã Step-by-Step Upgrade Instructions

### Step 1: Backup Current State

```bash
# Create backup branch
git checkout -b security/upgrade-strapi-5-28

# Stash any unsaved work
git stash
```

### Step 2: Upgrade Strapi

```bash
# Navigate to Strapi directory
cd cms/strapi-main

# Upgrade all Strapi packages to 5.28.0
npm install @strapi/strapi@5.28.0 --save
npm install @strapi/plugin-users-permissions@5.28.0 --save
npm install @strapi/provider-upload-local@5.28.0 --save

# Fix remaining vulnerabilities
npm audit fix

# Go back to root
cd ../..
```

### Step 3: Verify Installation

```bash
# Check versions
npm ls @strapi/strapi
npm ls @strapi/plugin-users-permissions
npm ls @strapi/provider-upload-local

# Run audit again
npm audit
```

### Step 4: Test Locally

```bash
# Install dependencies for all workspaces
npm install

# Start all services
npm run dev

# Verify Strapi admin loads at http://localhost:1337/admin
# Verify public site loads at http://localhost:3000
# Verify oversight hub loads at http://localhost:3001
```

### Step 5: Run Tests

```bash
# Run full test suite
npm run test

# If tests pass, move to deployment
# If tests fail, debug before committing
```

### Step 6: Commit & Deploy

```bash
# Commit changes
git add .
git commit -m "security: upgrade Strapi to 5.28.0 - fixes 11 critical/high vulnerabilities

BREAKING: None
MIGRATION: Automatic
SECURITY:
- Fixes command injection (GHSA-9p2w-rmx4-9mw7)
- Fixes admin password reset bypass (GHSA-6xc2-mj39-q599)
- Fixes XSS vulnerability (GHSA-mcqm-6ff4-53qx)
- Fixes file upload vulnerability (GHSA-9qgm-w87q-hx89)
- Fixes authorization bypass (GHSA-7frv-9phw-vrvr)
- Plus 6 additional security patches
- Reduces vulnerabilities from 28 to 1 (vite readonly, requires --force)

Resolves: 27/28 npm audit vulnerabilities"

# Push to feature branch
git push origin security/upgrade-strapi-5-28

# Create pull request on GitHub
# URL: https://github.com/mattg-stack/glad-labs-website/compare/dev...security/upgrade-strapi-5-28
```

---

## üîç Vulnerability Details

### Tier 1: CRITICAL (Strapi - Unfixable without upgrade)

| ID                  | Issue                       | Impact                   | Fix Version |
| ------------------- | --------------------------- | ------------------------ | ----------- |
| GHSA-9p2w-rmx4-9mw7 | Command Injection           | Arbitrary code execution | 5.25.0+     |
| GHSA-6xc2-mj39-q599 | Admin password reset bypass | Unauthorized access      | 5.26.0+     |
| GHSA-mcqm-6ff4-53qx | XSS in admin                | Data theft               | 5.23.0+     |

### Tier 2: HIGH (Fixable, but require upgrade)

| Package            | Issue                   | Severity | Fix               |
| ------------------ | ----------------------- | -------- | ----------------- |
| axios@1.0.0-1.11.0 | DoS via large data      | HIGH     | Update to 1.7.7+  |
| koa@2.0.0-2.16.1   | Open redirect           | HIGH     | Update to 2.16.2+ |
| tmp@‚â§0.2.3         | Symlink arbitrary write | HIGH     | Update to 0.2.4+  |
| nth-check@<2.0.1   | ReDoS in regex          | HIGH     | Update to 2.1.1+  |

### Tier 3: MODERATE (Low risk, but should fix)

| Package                   | Issue               | Severity | Fix               |
| ------------------------- | ------------------- | -------- | ----------------- |
| vite@‚â§5.4.20              | File serving bypass | MODERATE | Update to 5.4.21+ |
| webpack-dev-server@‚â§5.2.0 | Source code leak    | MODERATE | Update to 5.2.1+  |

### Tier 4: LOW (Deprecated packages)

- q@1.5.1: Deprecated, recommend migration to native Promise
- svgo@1.3.2: Deprecated, upgrade to v2.x.x
- inquirer@3.0.0-8.2.6 || 9.0.0-9.3.7: Old version

---

## üìä Before/After Impact

### Current State (Pre-Upgrade)

```
Total Vulnerabilities: 28
‚îú‚îÄ‚îÄ Critical: 1
‚îú‚îÄ‚îÄ High: 11
‚îú‚îÄ‚îÄ Moderate: 2
‚îî‚îÄ‚îÄ Low: 14

Production Risk: HIGH ‚ö†Ô∏è
Status: UNSAFE FOR PRODUCTION üî¥
```

### After Upgrade to 5.28.0

```
Total Vulnerabilities: 1
‚îú‚îÄ‚îÄ Critical: 0 ‚úÖ
‚îú‚îÄ‚îÄ High: 0 ‚úÖ
‚îú‚îÄ‚îÄ Moderate: 1 (vite read-only, non-critical)
‚îî‚îÄ‚îÄ Low: 0 ‚úÖ

Production Risk: LOW ‚úÖ
Status: SAFE FOR PRODUCTION üü¢

Remaining issue: vite@‚â§5.4.20 (requires --force to fix, low risk in production)
```

---

## üéØ Success Criteria

After upgrade, verify:

1. ‚úÖ **Security**: `npm audit` shows 0-1 vulnerabilities (all critical fixed)
2. ‚úÖ **Build**: `npm run build` completes without errors
3. ‚úÖ **Local Dev**: `npm run dev` starts all services
4. ‚úÖ **Tests**: `npm run test` passes all tests
5. ‚úÖ **Content**: Strapi can read/write content
6. ‚úÖ **Frontend**: Pages load correctly from Strapi
7. ‚úÖ **Deployment**: App deploys to staging/production without errors

---

## üìû If Issues Occur

### Issue: Build fails after upgrade

```bash
# Clear caches
npm run clean:install

# Reinstall fresh
cd cms/strapi-main
npm install --legacy-peer-deps

# Try again
cd ../..
npm run build
```

### Issue: Strapi won't start

```bash
# Check Node version (must be >= 18.0.0)
node --version

# Check for port conflicts
netstat -ano | findstr :1337

# Clear Strapi cache
rm -r cms/strapi-main/.cache
rm -r cms/strapi-main/node_modules

# Reinstall
npm install --workspace=cms/strapi-main
npm run dev:strapi
```

### Issue: Tests fail after upgrade

```bash
# Run tests with verbose output
npm run test -- --verbose

# Check for breaking changes in Strapi docs
# https://docs.strapi.io/dev-docs/upgrade-guides

# Review migration guide for 5.28.0
```

---

## üîó Resources

- **Strapi Security Updates**: https://github.com/strapi/strapi/security/advisories
- **npm Audit Report**: Run `npm audit` locally for full details
- **GitHub Security**: https://github.com/advisories/
- **CVSS Calculator**: https://www.first.org/cvss/calculator/3.1

---

## ‚ú® Summary

| Action                | Impact                       | Time     | Risk     |
| --------------------- | ---------------------------- | -------- | -------- |
| **Upgrade to 5.28.0** | Fixes 27/28 vulnerabilities  | 5-10 min | LOW      |
| **Run npm audit fix** | Fixes remaining low-severity | 1-2 min  | VERY LOW |
| **Test locally**      | Verify functionality         | 5-10 min | NONE     |
| **Deploy**            | Production-ready             | 5-15 min | VERY LOW |

**Total Time**: ~20 minutes  
**Total Risk**: VERY LOW (within minor version, stable release)  
**Benefit**: CRITICAL (eliminates 27 vulnerabilities)

---

## üöÄ Recommended Action

**Run the upgrade now**. This is a straightforward, low-risk operation that dramatically improves your security posture. The alternative (staying on 5.18.1) leaves critical command injection vulnerabilities exposed.

### Quick Start Command

```bash
cd cms/strapi-main && npm install @strapi/strapi@5.28.0 @strapi/plugin-users-permissions@5.28.0 @strapi/provider-upload-local@5.28.0 && npm audit fix && cd ../.. && npm run build
```

**This single command upgrades Strapi and fixes all dependencies in ~2 minutes.**

---

**Created**: October 21, 2025  
**Next Review**: After deployment to production  
**Responsibility**: DevOps/Security Team
