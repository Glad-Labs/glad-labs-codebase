# Railway DATABASE_URL Setup Guide

## Key Clarification: No Separate PRIVATE_URL Needed

Unlike other cloud providers, **Railway's `DATABASE_URL` is already the internal connection** with **no egress fees**. âœ…

You don't need to set up a separate `DATABASE_PRIVATE_URL` - just use the standard `DATABASE_URL` that Railway provides automatically.

---

## How It Works

### Railway's Connection Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Railway Project Network         â”‚
â”‚   (Internal - no egress charges)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  strapi      â”‚   PostgreSQL         â”‚
â”‚  service     â”‚   database           â”‚
â”‚              â”‚                      â”‚
â”‚ Uses:        â”‚   DATABASE_URL =     â”‚
â”‚ DATABASE_URL â”‚   postgres://        â”‚
â”‚              â”‚   user:pass@         â”‚
â”‚ FREE âœ…      â”‚   postgres:5432/db   â”‚
â”‚              â”‚                      â”‚
â”‚ (No setup    â”‚   (Internal IP)      â”‚
â”‚  needed!)    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cost Impact

- **DATABASE_URL on Railway:** $0 âœ… (internal network)
- **No egress charges** - You're already using the optimized connection

---

## Setup Steps

### Step 1: Verify DATABASE_URL is Set

On Railway:

1. Go to [railway.app](https://railway.app)
2. Navigate to your **Project** â†’ **strapi-production** service
3. Click the **"Variables"** tab
4. Confirm `DATABASE_URL` exists (it's auto-generated by Railway's PostgreSQL plugin)
5. Verify `DATABASE_CLIENT=postgres` is also set

### Step 2: That's It! âœ…

Your Strapi `database.ts` is already configured to use `DATABASE_URL`:

```typescript
postgres: {
  connection: {
    connectionString: env('DATABASE_URL'),
    // ... SSL and pool settings
  },
},
```

When you deploy to Railway with `DATABASE_CLIENT=postgres`, Strapi automatically uses the internal connection.

---

## Verification

### Check if Connection is Working

1. **View Strapi logs:**

   ```bash
   railway logs --service strapi-production
   ```

   Look for messages like:

   ```
   [strapi]: Database connection established âœ“
   ```

2. **Verify in Railway Variables:**
   - Go to Strapi service â†’ Variables
   - Confirm `DATABASE_URL` is present (looks like `postgresql://...`)
   - Confirm `DATABASE_CLIENT=postgres`

3. **Test the API:**
   ```bash
   curl https://strapi-production-b234.up.railway.app/api/graphql
   ```
   Should return a valid response (possibly 401 if no token, but not a connection error)

---

## Why No PRIVATE_URL?

Some cloud providers (like Render, Heroku) charge egress for database traffic and require you to use a special "private" URL to avoid fees.

**Railway is different:** They've designed their infrastructure so the default `DATABASE_URL` is the internal connection. No separate setup needed.

| Provider | Public URL       | Private URL          | Cost                    |
| -------- | ---------------- | -------------------- | ----------------------- |
| Railway  | Same as internal | Not needed           | âœ… Free                 |
| Render   | Has egress       | Special private URL  | âš ï¸ Charged if wrong URL |
| Heroku   | Has egress       | Separate private URL | âš ï¸ Charged if wrong URL |

---

## Environment Variables Summary

| Variable          | Value                    | Required | Purpose                        |
| ----------------- | ------------------------ | -------- | ------------------------------ |
| `DATABASE_CLIENT` | `postgres`               | âœ… Yes   | Tell Strapi to use PostgreSQL  |
| `DATABASE_URL`    | Auto-provided by Railway | âœ… Yes   | Connection string (internal)   |
| `DATABASE_SSL`    | `false` (for Railway)    | âŒ No    | Railway handles SSL internally |

**That's all you need!**

---

## Troubleshooting

### Issue: "Could not connect to database"

**Cause:** `DATABASE_CLIENT` not set to `postgres`

**Fix:**

1. Go to Strapi service â†’ Variables
2. Add: `DATABASE_CLIENT=postgres`
3. Redeploy

### Issue: Connection timeout

**Cause:** PostgreSQL service isn't running or `DATABASE_URL` is malformed

**Fix:**

1. Verify PostgreSQL service exists in your Railway project
2. Go to PostgreSQL service â†’ Variables
3. Copy `DATABASE_URL` value
4. Go to Strapi service â†’ Variables
5. Verify the value matches exactly
6. Redeploy

### Issue: "Connection refused"

**Cause:** PostgreSQL service not connected to Strapi

**Fix:**

1. In Railway, go to your Strapi service
2. Click "Variables"
3. The `DATABASE_URL` should auto-populate from your PostgreSQL plugin
4. If not, manually add it from PostgreSQL service variables
5. Redeploy

---

## Local Development

For local development, your `database.ts` defaults to SQLite (no PostgreSQL needed):

```typescript
const client = env('DATABASE_CLIENT', 'sqlite'); // Defaults to SQLite
```

To switch to PostgreSQL locally, create a `.env` file:

```bash
DATABASE_CLIENT=postgres
DATABASE_URL=postgresql://user:password@localhost:5432/strapi_db
```

---

## Performance Notes

Railway's internal connections are:

- **Fast:** Direct internal network (no internet hops)
- **Reliable:** No bandwidth throttling
- **Cost-effective:** No egress charges

---

## Related Configuration

Your Strapi setup also includes:

- âœ… Connection pooling (2-10 connections)
- âœ… SSL/TLS support for secure connections
- âœ… Automatic fallback to SQLite for local dev
- âœ… Configurable connection timeout (60s default)

---

## More Resources

- [Railway PostgreSQL Documentation](https://docs.railway.app/databases/postgresql)
- [Strapi Database Configuration](https://docs.strapi.io/dev-docs/configurations/database)
- [PostgreSQL Connection Strings](https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING)

---

## Summary

âœ… **What you have:**

- Railway provides `DATABASE_URL` automatically
- It's already the internal (free) connection
- No egress fees, no special setup needed

âœ… **What you do:**

1. Set `DATABASE_CLIENT=postgres` in Railway
2. Deploy - `DATABASE_URL` is auto-configured
3. Done! Connection is optimized and free

ğŸš€ **Cost savings:**

- No egress charges (already using internal network)
- No additional configuration overhead
- Railway just works out of the box
