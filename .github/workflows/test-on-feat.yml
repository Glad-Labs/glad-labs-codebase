name: Test on Feature Branch (DISABLED)

# âš ï¸ DISABLED - Feature branches do not run workflows
# Branch hierarchy:
#   feat/*     â†’ No workflows (commit freely)
#   dev        â†’ Full testing via test-on-dev.yml
#   staging    â†’ Deploy to staging environment
#   main       â†’ Deploy to production
#
# This allows you to commit frequently without triggering CI/CD on feature branches

on:
  workflow_dispatch: # Only manual trigger (effectively disabled)

jobs:
  test:
    runs-on: ubuntu-latest

    env:
      NODE_ENV: development

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install dependencies
        run: npm ci && npm ci --workspaces

      - name: ğŸ“¦ Install Python dependencies (CI/CD - Optimized)
        run: |
          python -m pip install --upgrade pip
          pip install --no-cache-dir -r scripts/requirements-ci.txt
        continue-on-error: false

      - name: ğŸ—‘ï¸ Clean pip cache
        run: pip cache purge

      - name: ğŸ“¦ Install backend-specific requirements
        run: |
          pip install --no-cache-dir -r src/cofounder_agent/requirements.txt
        continue-on-error: false

      - name: ğŸ—‘ï¸ Clean pip cache again
        run: pip cache purge

      - name: ğŸ”„ Load development environment
        run: cp .env.example .env.local

      - name: ğŸ§ª Run frontend tests
        run: npm run test:frontend:ci
        continue-on-error: true

      - name: ğŸ§ª Run Python tests
        run: npm run test:python
        continue-on-error: true

      - name: ğŸ§ª Run Python smoke tests
        run: npm run test:python:smoke
        continue-on-error: true

      - name: ğŸ” Run linting
        run: npm run lint:fix
        continue-on-error: true

      - name: ğŸ—ï¸ Build check (all workspaces)
        run: npm run build --if-present

      - name: âœ… Tests and build completed
        run: echo "Feature branch testing complete"
